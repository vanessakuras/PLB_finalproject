FROM ubuntu:18.04
MAINTAINER ILKILAB

RUN apt-get update
RUN apt install apache2 -yqq
RUN apt-get install python3-pip -yqq
RUN pip3 install pymysql

RUN a2dismod mpm_event
RUN a2enmod mpm_prefork cgi

ENV APACHE_RUN_USER www-data
ENV APACHE_RUN_GROUP www-data
ENV APACHE_LOG_DIR /var/log/apache2
ENV APACHE_LOCK_DIR /var/lock/apache2
ENV APACHE_PID_FILE /var/run/apache2.pid

EXPOSE 8080

ADD https://s3.amazonaws.com/richbourg-s3/mtwa/app/000-default.conf /etc/apache2/sites-enabled/000-default.conf
ADD https://s3.amazonaws.com/richbourg-s3/mtwa/app/ports.conf /etc/apache2/ports.conf

RUN mkdir /etc/mtwa
RUN mkdir /var/www/html/appdemo

ADD Multi-Tier-App-Demo/mtwa.conf /etc/mtwa/mtwa.conf
ADD Multi-Tier-App-Demo/html/* /var/www/html/appdemo/
ADD Multi-Tier-App-Demo/scripts/* /var/www/html/appdemo/
 

CMD ["/usr/sbin/apache2ctl", "-D", "FOREGROUND"]

